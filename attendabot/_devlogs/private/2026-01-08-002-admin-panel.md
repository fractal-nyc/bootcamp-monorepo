# 2026-01-08-002: Admin Panel

## Summary

Added a React admin panel with Express API layer for monitoring the bot and viewing Discord channel messages.

## What We Did

### 1. Refactored Bot Architecture
- Extracted Discord client into singleton service (`src/services/discord.ts`)
- Added stats tracking service (`src/services/stats.ts`)
- Added SQLite database service (`src/services/db.ts`)
- Moved bot logic to `src/bot/` subdirectory
- Created new main entry point (`src/index.ts`) that starts both bot and API

### 2. Created Express API Layer
- `POST /api/auth/login` - Password authentication with JWT
- `GET /api/status` - Bot uptime, stats, scheduled jobs
- `GET /api/channels` - List available Discord channels
- `GET /api/messages/:channelId` - Fetch recent messages from a channel

### 3. Built React Frontend
- Login page with password auth
- Status panel showing bot diagnostics
- Message feed with channel selector
- Auto-refresh every 30 seconds

### 4. Deployment
- Opened port 3001 in EC2 security group
- Added env vars to EC2: `ADMIN_PASSWORD`, `JWT_SECRET`, `API_PORT`
- Updated `update-bot.sh` to build frontend

## Current Deployment Info

| Resource | Value |
|----------|-------|
| **Instance IP** | `54.87.34.182` |
| **Admin Panel** | `http://54.87.34.182:3001` |
| **Admin Password** | `changeme123` |
| **API Port** | `3001` |

## New Environment Variables

```
ADMIN_PASSWORD=changeme123
JWT_SECRET=attendabot-jwt-secret-change-in-production
API_PORT=3001
```

## Files Created
- `src/api/index.ts` - Express server
- `src/api/middleware/auth.ts` - JWT auth middleware
- `src/api/routes/auth.ts` - Login endpoint
- `src/api/routes/status.ts` - Status endpoint
- `src/api/routes/channels.ts` - Channels endpoint
- `src/api/routes/messages.ts` - Messages endpoint
- `src/services/discord.ts` - Discord client singleton
- `src/services/stats.ts` - Stats tracking
- `src/services/db.ts` - SQLite setup
- `src/index.ts` - New main entry point
- `src/frontend/*` - Entire React app

## Files Modified
- `src/bot/index.ts` - Refactored to use shared services
- `package.json` - Added dependencies (express, better-sqlite3, jsonwebtoken, cors)
- `tsconfig.json` - Excluded frontend from backend build
- `update-bot.sh` - Added frontend build step
- `.env.example` - Added new env vars
- `.gitignore` - Added db/*.db pattern

## Issues Fixed
- Frontend static file path was wrong (`dist/frontend/dist` vs `src/frontend/dist`)
- React useEffect warnings for async setState
