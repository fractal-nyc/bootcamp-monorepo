# 2026-01-13-001: Startup DM and Deployment Improvements

## Summary

Added DirectMessages intent and startup DM notification, plus improved deployment script to sync .env file.

## What We Did

### 1. Discord Direct Messages (`backend/src/services/discord.ts`)

Added DirectMessages intent:

```typescript
client = new Client({
  intents: [
    GatewayIntentBits.Guilds,
    GatewayIntentBits.GuildMessages,
    GatewayIntentBits.MessageContent,
    GatewayIntentBits.GuildMembers,
    GatewayIntentBits.DirectMessages,  // Added
  ],
});
```

Added startup DM in the ready event handler:

```typescript
// Send startup DM to David
const davidUserId = process.env.DAVID_USER_ID;
if (davidUserId) {
  discordClient.users
    .fetch(davidUserId)
    .then((user) => user.send("Attendabot is online!"))
    .then(() => console.log("Sent startup DM to David"))
    .catch((error) => console.error("Failed to send startup DM:", error));
}
```

### 2. Deployment Script (`update-bot.sh`)

Added scp command before SSH block:

```bash
echo "Uploading .env file..."
scp -i "$SSH_KEY" "$SCRIPT_DIR/.env" ec2-user@$INSTANCE_IP:~/bootcamp-monorepo/attendabot/.env
```

This ensures the .env file is uploaded before `git pull` runs, so local env vars take precedence.

## Environment Variables

New variable required in `.env`:
- `DAVID_USER_ID` - Discord user ID to receive startup notification DM

## User Requirements

For the bot to DM you, you must have DMs enabled from server members:
1. Right-click the server
2. Privacy Settings
3. Enable "Allow direct messages from server members"
